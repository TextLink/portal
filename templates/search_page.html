<style type="text/css">

    #txt {
        border-radius: 25px;
        border: 2px dotted;
        position: relative;
        height: 600px;
        white-space: pre-wrap;
        font-size: 16px;
        overflow-y: scroll;
        resize: vertical;
    }

    #annotation-select {
        float: left;
        width: 12vw;
        resize: vertical;
        overflow: scroll;
        height: 800px;
        font-family: 'Times New Roman';
        font-size: 16px;
    }

    #sense-select {
        top: 50px;
        float: right;
        width: 350px;
        overflow: scroll;
    }

    #upload_div {
        float: right;
        width: 250px;
        overflow: scroll;
    }
    #dimlex_div{
                float:right;
        background-color: azure;



    }
</style>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search!</title>
</head>
<body>
<form action="search_page.html" method="get">
    {% csrf_token %}
    <select id='file-select' name='file-select' method="get">
        {% for obj in documents %}
            <option value="{{ obj.filename }} ">{{ obj.filename }}</option>
        {% endfor %}
    </select>
</form>

<div id='upload_div' name='upload_div' contenteditable='false'>
    Click here to upload new files:
    <form action="" method="post">
        {% csrf_token %}
        <input type="submit" name="upload-button" value="Upload">
    </form>
</div>

<select name='sense1List[]' id='sense-select' data-placeholder='First Semantic Class' multiple class='chosen-select'
        tabindex='11'>
    {% for sense in senses %}
        {% if '.' not in sense %}
            </optgroup>
            <optgroup label="{{ sense }} ">

        {% endif %}
        <option value="{{ sense }} ">{{ sense }} </option>
    {% endfor %}
</select>

<br>

<select name='connectiveList[]' id='conn-select' data-placeholder='Connective' multiple class='chosen-select'
        tabindex='11'>
    {% for key, value in connective_array.items %}
        <option value="{{ key }} ">{{ key }} {{ value }} </option>
    {% endfor %}
</select>


<button>Search</button>

<select name='annotationList' id='annotation-select' multiple size='30'>
    {% for ann in annotations %}
        <option value="{{ ann.id }} ">{{ ann.id }} - {{ ann.conn }} ({{ ann.type }})</option>
    {% endfor %}
</select>


<div id='txt' name='out' contenteditable='false'>
    {{ selectedFile.raw_file.read }}
</div>

<p><a href="{% url 'home' %}">Return to home</a></p>


<div id="dimlex_div"><h2>Dimlex</h2></div>


</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $("#file-select").change(function () {
            $.ajax({
                url: 'http://localhost:8000/upload/search_page_rest?file=' + $("#file-select").val(),
                type: 'GET',
                crossDomain: true,
                dataType: 'json',
                success: function (data) {
                    var content = data["text"];
                    content = content.replace(/[\n]/g, "<br />").replace(/[\r]/g, "");
                    var selectData = "<select name='conList' id='conn-select' multiple size='30'>\n";
                    var count = 1;
                    $.each(data, function (key, value) {
                        selectData += '<option value=' + key + '>' + count + '- ' + value + '</option>';
                        count += 1;
                    });
                    selectData += '</select>';
                    $('#conn-select').html(selectData);
                    $("#txt").html(JSON.stringify(content));

                },
                error: function () {
                    alert('Failed!');
                },
            });
        });
        //sense search
        $("button").click(function () {

            if ($("#conn-select").val() == null) {
                $.ajax({
                    url: 'http://localhost:8000/upload/search_sense_rest?file=' + $("#file-select").val() + '&sense=' + $("#sense-select").val(),
                    type: 'GET',
                    crossDomain: true,
                    dataType: 'json',
                    success: function (data) {
                        var content = data["text"];
                        content = content.replace(/[\n]/g, "<br />").replace(/[\r]/g, "");
                        var annotation_data = "<select name='annotationList' id='annotation-select' multiple size='30'>\n";
                        var count = 1;
                        $.each(data, function (key, value) {
                            annotation_data += '<option value=' + key + '>' + count + '- ' + value + '</option>';
                            count += 1;
                        });
                        annotation_data += '</select>';
                        $('#annotation-select').html(annotation_data);
                        $("#txt").html(JSON.stringify(content));
                    },
                    error: function () {
                        alert('Failed!');
                    },
                });
            }
            else {
                $.ajax({
                    url: 'http://localhost:8000/get_sense_wrt_connective?connective=' + $("#conn-select").val() + '&lang=English',
                    type: 'GET',
                    crossDomain: true,
                    dataType: 'json',
                    success: function (data) {
                        //var json_data =   JSON.parse(data);

                        var dimlex_info = "<ul>"
                        $.each(data, function (index, elem) {
                            dimlex_info +=  'DIMLEX<br> <b>' + elem['word'] + '</b>';
                            $.each(elem['relation'], function (index, pdtb) {
                                dimlex_info += '<li>' + pdtb['pdtb2_relation'][0]['sense'] + '(' + pdtb['pdtb2_relation'][0]['freq'] + '/' +
                                   pdtb['pdtb2_relation'][0]['anno_N'] + ')' + '</li>'
                            });
                        });
                        dimlex_info += '</ul>';
                        $("#dimlex_div").html(dimlex_info);
                    },
                    error: function () {
                        alert('Failed!');
                    },
                });
            }
        });


    });
</script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.min.css">
<script type='text/javascript'>
    window.onload = function () {
        $(".chosen-select").chosen({
                no_results_text: "Oops, nothing found!"
            }
        );
    }</script>
